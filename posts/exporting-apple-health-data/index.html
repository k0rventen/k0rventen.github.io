<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Exporting Apple Health Data | k0rventen&#39;s blog</title>
<meta name="keywords" content="apple, influx, python, grafana">
<meta name="description" content="Graph your health using grafana">
<meta name="author" content="">
<link rel="canonical" href="/posts/exporting-apple-health-data/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/posts/exporting-apple-health-data/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="/posts/exporting-apple-health-data/">
  <meta property="og:site_name" content="k0rventen&#39;s blog">
  <meta property="og:title" content="Exporting Apple Health Data">
  <meta property="og:description" content="Graph your health using grafana">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-08-23T20:44:24+02:00">
    <meta property="article:modified_time" content="2022-08-23T20:44:24+02:00">
    <meta property="article:tag" content="Apple">
    <meta property="article:tag" content="Influx">
    <meta property="article:tag" content="Python">
    <meta property="article:tag" content="Grafana">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Exporting Apple Health Data">
<meta name="twitter:description" content="Graph your health using grafana">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/posts/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Exporting Apple Health Data",
      "item": "/posts/exporting-apple-health-data/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Exporting Apple Health Data",
  "name": "Exporting Apple Health Data",
  "description": "Graph your health using grafana",
  "keywords": [
    "apple", "influx", "python", "grafana"
  ],
  "articleBody": "Example of metrics exported from Apple Health in Grafana: If you want to test the tool, check out the Github repo here\nwhat \u0026 why Having a health tracker such as an apple watch is great, but the default views in the Health app on the iPhone can be too simplistic. We can’t correlate between metrics, define a specific time range, etc..\nBut it’s possible to export all of the collected health data in an archive. The goal then is to parse this archive and import it in a more analysis friendly tool. I’m most familiar with the InfluxDB+Grafana stack, so that’s what I’ll be using, but the parsing tool should provide a groundwork for parsing the exported data, and could be adapted to import to other tools.\nhow Architecture The tool is a 3 components docker-compose stack:\na parsing container that will ingest our exported health data, influxDB for storing the data grafana to visualize Export format From support.apple.com:\nShare your health and fitness data in XML format You can export all of your health and fitness data from Health in XML format, which is a common format for sharing data between apps. Tap your profile picture or initials at the top right. If you don’t see your profile picture or initials, tap Summary or Browse at the bottom of the screen, then scroll to the top of the screen. Tap Export all health data, then choose a method for sharing your data. This will create a .zip file that can be shared from the iPhone.\nOnce you’ve copied/share the file to your computer, unzip it. You should have a export.xml file in there. This file contains all the health records recorded by the Health app.\nThe format is as follow: k\n",
  "wordCount" : "416",
  "inLanguage": "en",
  "datePublished": "2022-08-23T20:44:24+02:00",
  "dateModified": "2022-08-23T20:44:24+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/exporting-apple-health-data/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "k0rventen's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="&gt; k0rventen: ~ (Alt + H)">&gt; k0rventen: ~</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/links" title="links">
                    <span>links</span>
                </a>
            </li>
            <li>
                <a href="/posts" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="/search" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Exporting Apple Health Data
    </h1>
    <div class="post-description">
      Graph your health using grafana
    </div>
    <div class="post-meta"><span title='2022-08-23 20:44:24 +0200 +0200'>August 23, 2022</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;416 words

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#what--why">what &amp; why</a></li>
  </ul>

  <ul>
    <li><a href="#architecture">Architecture</a></li>
    <li><a href="#export-format">Export format</a></li>
    <li><a href="#tips-on-analyzing-the-data">Tips on analyzing the data</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p><em>Example of metrics exported from Apple Health in Grafana:</em>
<img loading="lazy" src="https://github.com/k0rventen/apple-health-grafana/raw/main/example.png"></p>
<p><strong>If you want to test the tool, check out the <a href="https://github.com/k0rventen/apple-health-grafana">Github repo here</a></strong></p>
<h2 id="what--why">what &amp; why<a hidden class="anchor" aria-hidden="true" href="#what--why">#</a></h2>
<p>Having a health tracker such as an apple watch is great, but the default views in the Health app on the iPhone can be too simplistic. We can&rsquo;t correlate between metrics, define a specific time range, etc..</p>
<p>But it&rsquo;s possible to export all of the collected health data in an archive. The goal then is to parse this archive and import it in a more analysis friendly tool. I&rsquo;m most familiar with the InfluxDB+Grafana stack, so that&rsquo;s what I&rsquo;ll be using, but the parsing tool should provide a groundwork for parsing the exported data, and could be adapted to import to other tools.</p>
<h1 id="how">how<a hidden class="anchor" aria-hidden="true" href="#how">#</a></h1>
<h2 id="architecture">Architecture<a hidden class="anchor" aria-hidden="true" href="#architecture">#</a></h2>
<p>The tool is a 3 components docker-compose stack:</p>
<ul>
<li>a parsing container that will ingest our exported health data,</li>
<li>influxDB for storing the data</li>
<li>grafana to visualize</li>
</ul>
<h2 id="export-format">Export format<a hidden class="anchor" aria-hidden="true" href="#export-format">#</a></h2>
<p>From support.apple.com:</p>
<pre tabindex="0"><code>Share your health and fitness data in XML format

You can export all of your health and fitness data from Health in XML format, which is a common format for sharing data between apps.

    Tap your profile picture or initials at the top right.

    If you don’t see your profile picture or initials, tap Summary or Browse at the bottom of the screen, then scroll to the top of the screen.

    Tap Export all health data, then choose a method for sharing your data.
</code></pre><p>This will create a .zip file that can be shared from the iPhone.</p>
<p>Once you&rsquo;ve copied/share the file to your computer, unzip it. You should have a <code>export.xml</code> file in there.
This file contains all the health records recorded by the Health app.</p>
<p>The format is as follow:
k</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Record</span> <span class="na">type=</span><span class="s">&#34;HKQuantityTypeIdentifierHeartRate&#34;</span> <span class="na">sourceName=</span><span class="s">&#34;apple-watch&#34;</span> <span class="na">sourceVersion=</span><span class="s">&#34;8.7&#34;</span> <span class="na">device=</span><span class="s">&#34;&amp;lt;&amp;lt;HKDevice: 0x2803d9810&amp;gt;, name:Apple Watch, manufacturer:Apple Inc., model:Watch, hardware:Watch3,4, software:8.7&amp;gt;&#34;</span> <span class="na">unit=</span><span class="s">&#34;count/min&#34;</span> <span class="na">creationDate=</span><span class="s">&#34;2022-07-26 17:28:52 +0200&#34;</span> <span class="na">startDate=</span><span class="s">&#34;2022-07-26 17:22:58 +0200&#34;</span> <span class="na">endDate=</span><span class="s">&#34;2022-07-26 17:22:58 +0200&#34;</span> <span class="na">value=</span><span class="s">&#34;73&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;MetadataEntry</span> <span class="na">key=</span><span class="s">&#34;HKMetadataKeyHeartRateMotionContext&#34;</span> <span class="na">value=</span><span class="s">&#34;0&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"> <span class="nt">&lt;/Record&gt;</span>
</span></span></code></pre></div><p>Each record contains at least a <code>type</code>, which is the category of the metric, <code>timestamps</code>, a <code>value</code> and a <code>unit</code>. We also have access to the tracker that recorded the metric.</p>
<p>The ingester iterates through all the records, parses the important fields, then yields a dict that can be used as a measurement for influx.</p>
<h2 id="tips-on-analyzing-the-data">Tips on analyzing the data<a hidden class="anchor" aria-hidden="true" href="#tips-on-analyzing-the-data">#</a></h2>
<p>Some metrics can be displayed <strong>as is</strong>, but others might need tweaking in the influx request:</p>
<ul>
<li>adjusting the time interval to 1d.</li>
<li>using <strong>sum()</strong> instead of <strong>mean()</strong> to aggregate the metrics for a given interval.</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/apple/">Apple</a></li>
      <li><a href="/tags/influx/">Influx</a></li>
      <li><a href="/tags/python/">Python</a></li>
      <li><a href="/tags/grafana/">Grafana</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="/posts/kube-user/">
    <span class="title">« Prev</span>
    <br>
    <span>Add a new external user (or bot) in k8s</span>
  </a>
  <a class="next" href="/posts/flask-gatekeeper/">
    <span class="title">Next »</span>
    <br>
    <span>Gatekeeper, a ban &amp; rate limit lib for flask</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="/">k0rventen&#39;s blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
