<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How to resize an LVM ext4 partition (and also non-LVM because old VMs) | k0rventen&#39;s blog</title>
<meta name="keywords" content="lvm, ext4, linux, fdisk">
<meta name="description" content="this thing you do every 6 months and forget">
<meta name="author" content="">
<link rel="canonical" href="/posts/lvm-resize/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/posts/lvm-resize/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="/posts/lvm-resize/">
  <meta property="og:site_name" content="k0rventen&#39;s blog">
  <meta property="og:title" content="How to resize an LVM ext4 partition (and also non-LVM because old VMs)">
  <meta property="og:description" content="this thing you do every 6 months and forget">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-04-29T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-04-29T00:00:00+00:00">
    <meta property="article:tag" content="Lvm">
    <meta property="article:tag" content="Ext4">
    <meta property="article:tag" content="Linux">
    <meta property="article:tag" content="Fdisk">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to resize an LVM ext4 partition (and also non-LVM because old VMs)">
<meta name="twitter:description" content="this thing you do every 6 months and forget">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/posts/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "How to resize an LVM ext4 partition (and also non-LVM because old VMs)",
      "item": "/posts/lvm-resize/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to resize an LVM ext4 partition (and also non-LVM because old VMs)",
  "name": "How to resize an LVM ext4 partition (and also non-LVM because old VMs)",
  "description": "this thing you do every 6 months and forget",
  "keywords": [
    "lvm", "ext4", "linux", "fdisk"
  ],
  "articleBody": "what \u0026 why Every now and then, I have to resize a root partition on an LVM linux machine.\nEvery time, I take more time to recall what steps to do, and in which order. Is it pvresize, then lvrezise, or lvextend ?\nEvery. god. damn. time. Let’s put an end to this by having the steps written down somewhere, so I can reference them when the ‘we should increase this vm’s disk’ sentence is heard.\nAlso, how to do it on a non-LVM machine, because sometimes you encounter old, very old VMs that do not use LVM.\nhow The LVM way let’s make some assumptions:\nyou are on a fairly recent linux, with the fdisk, df, and the lvm utils installed LVM is already enabled for the partition you have to increase It’s a VM and you just changed the disk’s size (eg Vcenter, qemu-img..) First, let’s check on the VM if we see the new disk size using fdisk:\nroot@debian:~# fdisk -l Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x8b02b392 Device Boot Start End Sectors Size Id Type /dev/vda1 * 2048 999423 997376 487M 83 Linux /dev/vda2 1001470 41940991 40939522 19.5G 5 Extended /dev/vda5 1001472 41940991 40939520 19.5G 8e Linux LVM Ok, so we do have a 30G disk to play with, and our linux fs is 19.5G. Due to the LVM setup, our partition is at /dev/mapper/debian–vg-root.\nHere, we have two possible ways of doing things:\nwe either resize the current ‘Extended’ partition using fdisk, and then we propagate the new size to LVM or we create a new partition from the available space, and add it to our LVM volumes. If you want to use the solution 1, go down and read the section on non-LVM resizing, and apply the steps until the resize2fs. Then come back. Otherwise, tag along:\nFirst, let’s create a new partition using fdisk:\nroot@debian:~# fdisk /dev/vda Welcome to fdisk (util-linux 2.38.1). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. This disk is currently in use - repartitioning is probably a bad idea. It's recommended to umount all file systems, and swapoff all swap partitions on this disk. Now, we’ll create a new partition that will use the new available space:\nCommand (m for help): n Partition type p primary (1 primary, 1 extended, 2 free) l logical (numbered from 5) Select (default p): p Partition number (3,4, default 3): 3 First sector (41940992-62914559, default 41940992): Last sector, +/-sectors or +/-size{K,M,G,T,P} (41940992-62914559, default 62914559): Created a new partition 3 of type 'Linux' and of size 10 GiB. We’ll change its type to 8e, which is the one for LVM\nCommand (m for help): t Partition number (1-3,5, default 5): 3 Hex code or alias (type L to list all): 8e Changed type of partition 'Linux' to 'Linux LVM'. Command (m for help): p Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x8b02b392 Device Boot Start End Sectors Size Id Type /dev/vda1 * 2048 999423 997376 487M 83 Linux /dev/vda2 1001470 41940991 40939522 19.5G 5 Extended /dev/vda3 41940992 62914559 20973568 10G 8e Linux LVM /dev/vda5 1001472 41940991 40939520 19.5G 8e Linux LVM Partition table entries are not in disk order. And we write the partition table:\nCommand (m for help): w The partition table has been altered. Syncing disks. Ok, we now have a new partition of 10G:\nroot@debian:~# fdisk -l Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: dos Disk identifier: 0x8b02b392 Device Boot Start End Sectors Size Id Type /dev/vda1 * 2048 999423 997376 487M 83 Linux /dev/vda2 1001470 41940991 40939522 19.5G 5 Extended /dev/vda3 41940992 62914559 20973568 10G 8e Linux LVM /dev/vda5 1001472 41940991 40939520 19.5G 8e Linux LVM We’ll now create a new volume:\nroot@debian:~# pvcreate /dev/vda3 Physical volume \"/dev/vda3\" successfully created. root@debian:~# pvs PV VG Fmt Attr PSize PFree /dev/vda3 debian-vg lvm2 a-- 10.00g 10.00g /dev/vda5 debian-vg lvm2 a-- \u003c19.52g 0 We then extend our current VG with this new PV:\nroot@debian:~# vgextend debian-vg /dev/vda3 Volume group \"debian-vg\" successfully extended root@debian:~# vgs VG #PV #LV #SN Attr VSize VFree debian-vg 2 2 0 wz--n- \u003c29.52g 10.00g And finally, we extend the LV of our root partition with this new PV:\nroot@debian:~# lvextend /dev/debian-vg/root /dev/vda3 Size of logical volume debian-vg/root changed from 18.56 GiB (4752 extents) to 28.56 GiB (7312 extents). Logical volume debian-vg/root successfully resized. root@debian:~# lvs LV VG Attr LSize Pool Origin Data% Meta% Move Log Cpy%Sync Convert root debian-vg -wi-ao---- 28.56g swap_1 debian-vg -wi-ao---- 980.00m We can now resize the filesystem of the VG using resize2fs:\nroot@debian:~# resize2fs /dev/mapper/debian--vg-root resize2fs 1.47.0 (5-Feb-2023) Filesystem at /dev/mapper/debian--vg-root is mounted on /; on-line resizing required old_desc_blocks = 3, new_desc_blocks = 4 The filesystem on /dev/mapper/debian--vg-root is now 7487488 (4k) blocks long. A final check to verify that our fs takes all the space:\nroot@debian:~# df -h Filesystem Size Used Avail Use% Mounted on udev 961M 0 961M 0% /dev tmpfs 197M 632K 197M 1% /run /dev/mapper/debian--vg-root 28G 1.6G 26G 6% / tmpfs 984M 0 984M 0% /dev/shm tmpfs 5.0M 0 5.0M 0% /run/lock /dev/vda1 455M 98M 333M 23% /boot tmpfs 197M 0 197M 0% /run/user/1000 And we’re done !\nThe non LVM way Disclaimer, this only works if the partition you intend to extend is the last one on the disk.\nIf you read the section on LVM, then the procedure is the same, but without the LVM stuff:\nwe use fdisk to delete, extend, write the new partition, we resize the fs accordingly tadaa it’s done. Ok first, check the disk listing:\ncoco@buntuvm:~$ sudo fdisk -l ... Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB Device Start End Sectors Size Type /dev/vda1 2048 4095 2048 1M BIOS boot /dev/vda2 4096 52426751 52422656 25G Linux filesystem Our /dev/vda2 is where our root partition is, and is 25Gig. But the disk is 35Gig, meaning he can extend the partition by around 10 Gig.\nIf we confirm using df, we cam see that our filesystem reports a Size of 25G.\ncoco@buntuvm:~$ sudo df -h Filesystem Size Used Avail Use% Mounted on tmpfs 392M 1.6M 391M 1% /run /dev/vda2 25G 8.9G 15G 39% / tmpfs 2.0G 0 2.0G 0% /dev/shm tmpfs 5.0M 8.0K 5.0M 1% /run/lock tmpfs 392M 108K 392M 1% /run/user/1000 So now we’ll use fdisk on our disk (the whole disk, not the partition)\ncoco@buntuvm:~$ sudo fdisk /dev/vda Welcome to fdisk (util-linux 2.39.3). Changes will remain in memory only, until you decide to write them. Be careful before using the write command. GPT PMBR size mismatch (52428799 != 73400319) will be corrected by write. The backup GPT table is not on the end of the device. This problem will be corrected by write. This disk is currently in use - repartitioning is probably a bad idea. It's recommended to umount all file systems, and swapoff all swap partitions on this disk. We can use ‘p’ to print the partition table:\nCommand (m for help): p Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB Device Start End Sectors Size Type /dev/vda1 2048 4095 2048 1M BIOS boot /dev/vda2 4096 52426751 52422656 25G Linux filesystem Now, we’ll delete the partition number 2 (the Linux filesystem one). Note that this is ‘safe’ because we are not actually deleting the partition, but rather the information about where the partition starts and where it ends.\nCommand (m for help): d Partition number (1,2, default 2): 2 Partition 2 has been deleted. And now, we’ll recreate the partition, with the same start sector, but fdisk will extend the end to the last available sector on our disk, which is ‘10G further’ than before.\nCommand (m for help): n Partition number (2-128, default 2): First sector (4096-73400286, default 4096): Last sector, +/-sectors or +/-size{K,M,G,T,P} (4096-73400286, default 73398271): Created a new partition 2 of type 'Linux filesystem' and of size 35 GiB. Partition #2 contains a ext4 signature. Do you want to remove the signature? [Y]es/[N]o: n If we print the partition table again, we can see that our second partition is now 35G in size.\nCommand (m for help): p Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disklabel type: gpt Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB Device Start End Sectors Size Type /dev/vda1 2048 4095 2048 1M BIOS boot /dev/vda2 4096 73398271 73394176 35G Linux filesystem Finally, we do not forget to write our changes to the disk:\nCommand (m for help): w The partition table has been altered. Syncing disks. Great. Now the disk has been resized, but the filesystem doesn’t know it yet. If we rerun df, we’ll see the same 25G listed:\ncoco@buntuvm:~$ sudo df -h Filesystem Size Used Avail Use% Mounted on tmpfs 392M 1.6M 391M 1% /run /dev/vda2 25G 8.9G 15G 39% / tmpfs 2.0G 0 2.0G 0% /dev/shm tmpfs 5.0M 8.0K 5.0M 1% /run/lock tmpfs 392M 108K 392M 1% /run/user/1000 To fix that, we’ll use resize2fs that can extend a given ext4 partition. Here, we’ll give it the partition path:\ncoco@buntuvm:~$ sudo resize2fs /dev/vda2 resize2fs 1.47.0 (5-Feb-2023) Filesystem at /dev/vda2 is mounted on /; on-line resizing required old_desc_blocks = 4, new_desc_blocks = 5 The filesystem on /dev/vda2 is now 9174272 (4k) blocks long. And if we check the output of df again, we now have 35G to play with !\ncoco@buntuvm:~$ sudo df -h Filesystem Size Used Avail Use% Mounted on tmpfs 392M 1.6M 391M 1% /run /dev/vda2 35G 8.9G 24G 28% / tmpfs 2.0G 0 2.0G 0% /dev/shm tmpfs 5.0M 8.0K 5.0M 1% /run/lock tmpfs 392M 108K 392M 1% /run/user/1000 Hopefully these instructions will serve me well next time (hey future me !)\nRegards, previous me\n",
  "wordCount" : "1770",
  "inLanguage": "en",
  "datePublished": "2024-04-29T00:00:00Z",
  "dateModified": "2024-04-29T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/posts/lvm-resize/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "k0rventen's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="&gt; k0rventen: ~ (Alt + H)">&gt; k0rventen: ~</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/links" title="links">
                    <span>links</span>
                </a>
            </li>
            <li>
                <a href="/posts" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="/search" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="/">Home</a>&nbsp;»&nbsp;<a href="/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      How to resize an LVM ext4 partition (and also non-LVM because old VMs)
    </h1>
    <div class="post-description">
      this thing you do every 6 months and forget
    </div>
    <div class="post-meta"><span title='2024-04-29 00:00:00 +0000 UTC'>April 29, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1770 words

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#the-lvm-way">The LVM way</a></li>
    <li><a href="#the-non-lvm-way">The non LVM way</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="what--why">what &amp; why<a hidden class="anchor" aria-hidden="true" href="#what--why">#</a></h1>
<p>Every now and then, I have to resize a root partition on an LVM linux machine.</p>
<p>Every time, I take more time to recall what steps to do, and in which order. Is it <code>pvresize</code>, then <code>lvrezise</code>, or <code>lvextend</code> ?</p>
<p>Every. god. damn. time. Let&rsquo;s put an end to this by having the steps written down somewhere,
so I can reference them when the &lsquo;we should increase this vm&rsquo;s disk&rsquo; sentence is heard.</p>
<p>Also, how to do it on a non-LVM machine, because sometimes you encounter old, very old VMs that do not use LVM.</p>
<h1 id="how">how<a hidden class="anchor" aria-hidden="true" href="#how">#</a></h1>
<h2 id="the-lvm-way">The LVM way<a hidden class="anchor" aria-hidden="true" href="#the-lvm-way">#</a></h2>
<p>let&rsquo;s make some assumptions:</p>
<ul>
<li>you are on a fairly recent linux, with the fdisk, df, and the lvm utils installed</li>
<li>LVM is already enabled for the partition you have to increase</li>
<li>It&rsquo;s a VM and you just changed the disk&rsquo;s size (eg Vcenter, qemu-img..)</li>
</ul>
<p>First, let&rsquo;s check on the VM if we see the new disk size using <code>fdisk</code>:</p>
<pre tabindex="0"><code>root@debian:~# fdisk -l
Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x8b02b392

Device     Boot   Start      End  Sectors  Size Id Type
/dev/vda1  *       2048   999423   997376  487M 83 Linux
/dev/vda2       1001470 41940991 40939522 19.5G  5 Extended
/dev/vda5       1001472 41940991 40939520 19.5G 8e Linux LVM
</code></pre><p>Ok, so we do have a 30G disk to play with, and our linux fs is 19.5G. Due to the LVM setup, our partition is at /dev/mapper/debian&ndash;vg-root.</p>
<p>Here, we have two possible ways of doing things:</p>
<ul>
<li>we either resize the current &lsquo;Extended&rsquo; partition using fdisk, and then we propagate the new size to LVM</li>
<li>or we create a new partition from the available space, and add it to our LVM volumes.</li>
</ul>
<p>If you want to use the solution 1, go down and read the <a href="#the-non-lvm-way">section on non-LVM resizing</a>, and apply the steps until the resize2fs. Then come back. Otherwise, tag along:</p>
<p>First, let&rsquo;s create a new partition using fdisk:</p>
<pre tabindex="0"><code>root@debian:~# fdisk /dev/vda

Welcome to fdisk (util-linux 2.38.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

This disk is currently in use - repartitioning is probably a bad idea.
It&#39;s recommended to umount all file systems, and swapoff all swap
partitions on this disk.
</code></pre><p>Now, we&rsquo;ll create a new partition that will use the new available space:</p>
<pre tabindex="0"><code>Command (m for help): n
Partition type
   p   primary (1 primary, 1 extended, 2 free)
   l   logical (numbered from 5)
Select (default p): p
Partition number (3,4, default 3): 3
First sector (41940992-62914559, default 41940992): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (41940992-62914559, default 62914559): 

Created a new partition 3 of type &#39;Linux&#39; and of size 10 GiB.
</code></pre><p>We&rsquo;ll change its type to <code>8e</code>, which is the one for LVM</p>
<pre tabindex="0"><code>Command (m for help): t
Partition number (1-3,5, default 5): 3
Hex code or alias (type L to list all): 8e

Changed type of partition &#39;Linux&#39; to &#39;Linux LVM&#39;.

Command (m for help): p
Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x8b02b392

Device     Boot    Start      End  Sectors  Size Id Type
/dev/vda1  *        2048   999423   997376  487M 83 Linux
/dev/vda2        1001470 41940991 40939522 19.5G  5 Extended
/dev/vda3       41940992 62914559 20973568   10G 8e Linux LVM
/dev/vda5        1001472 41940991 40939520 19.5G 8e Linux LVM

Partition table entries are not in disk order.
</code></pre><p>And we write the partition table:</p>
<pre tabindex="0"><code>Command (m for help): w
The partition table has been altered.
Syncing disks.
</code></pre><p>Ok, we now have a new partition of 10G:</p>
<pre tabindex="0"><code>root@debian:~# fdisk -l
Disk /dev/vda: 30 GiB, 32212254720 bytes, 62914560 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x8b02b392

Device     Boot    Start      End  Sectors  Size Id Type
/dev/vda1  *        2048   999423   997376  487M 83 Linux
/dev/vda2        1001470 41940991 40939522 19.5G  5 Extended
/dev/vda3       41940992 62914559 20973568   10G 8e Linux LVM
/dev/vda5        1001472 41940991 40939520 19.5G 8e Linux LVM
</code></pre><p>We&rsquo;ll now create a new volume:</p>
<pre tabindex="0"><code>root@debian:~# pvcreate /dev/vda3
  Physical volume &#34;/dev/vda3&#34; successfully created.

root@debian:~# pvs
  PV         VG        Fmt  Attr PSize   PFree 
  /dev/vda3  debian-vg lvm2 a--   10.00g 10.00g
  /dev/vda5  debian-vg lvm2 a--  &lt;19.52g     0 
</code></pre><p>We then extend our current VG with this new PV:</p>
<pre tabindex="0"><code>root@debian:~# vgextend debian-vg /dev/vda3
  Volume group &#34;debian-vg&#34; successfully extended

root@debian:~# vgs
  VG        #PV #LV #SN Attr   VSize   VFree 
  debian-vg   2   2   0 wz--n- &lt;29.52g 10.00g
</code></pre><p>And finally, we extend the LV of our root partition with this new PV:</p>
<pre tabindex="0"><code>root@debian:~# lvextend /dev/debian-vg/root /dev/vda3
  Size of logical volume debian-vg/root changed from 18.56 GiB (4752 extents) to 28.56 GiB (7312 extents).
  Logical volume debian-vg/root successfully resized.

root@debian:~# lvs
  LV     VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  root   debian-vg -wi-ao----  28.56g                                                    
  swap_1 debian-vg -wi-ao---- 980.00m                                                    
</code></pre><p>We can now resize the filesystem of the VG using <code>resize2fs</code>:</p>
<pre tabindex="0"><code>root@debian:~# resize2fs /dev/mapper/debian--vg-root 
resize2fs 1.47.0 (5-Feb-2023)
Filesystem at /dev/mapper/debian--vg-root is mounted on /; on-line resizing required
old_desc_blocks = 3, new_desc_blocks = 4
The filesystem on /dev/mapper/debian--vg-root is now 7487488 (4k) blocks long.
</code></pre><p>A final check to verify that our fs takes all the space:</p>
<pre tabindex="0"><code>root@debian:~# df -h
Filesystem                   Size  Used Avail Use% Mounted on
udev                         961M     0  961M   0% /dev
tmpfs                        197M  632K  197M   1% /run
/dev/mapper/debian--vg-root   28G  1.6G   26G   6% /
tmpfs                        984M     0  984M   0% /dev/shm
tmpfs                        5.0M     0  5.0M   0% /run/lock
/dev/vda1                    455M   98M  333M  23% /boot
tmpfs                        197M     0  197M   0% /run/user/1000
</code></pre><p>And we&rsquo;re done !</p>
<h2 id="the-non-lvm-way">The non LVM way<a hidden class="anchor" aria-hidden="true" href="#the-non-lvm-way">#</a></h2>
<p>Disclaimer, this only works if the partition you intend to extend is the last one on the disk.</p>
<p>If you read the section on LVM, then the procedure is the same, but without the LVM stuff:</p>
<ul>
<li>we use fdisk to delete, extend, write the new partition,</li>
<li>we resize the fs accordingly</li>
<li>tadaa it&rsquo;s done.</li>
</ul>
<p>Ok first, check the disk listing:</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo fdisk -l
...
Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB

Device     Start      End  Sectors Size Type
/dev/vda1   2048     4095     2048   1M BIOS boot
/dev/vda2   4096 52426751 52422656  25G Linux filesystem
</code></pre><p>Our /dev/vda2 is where our root partition is, and is 25Gig. But the disk is 35Gig, meaning he can extend the partition by around 10 Gig.</p>
<p>If we confirm using df, we cam see that our filesystem reports a Size of 25G.</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           392M  1.6M  391M   1% /run
/dev/vda2        25G  8.9G   15G  39% /
tmpfs           2.0G     0  2.0G   0% /dev/shm
tmpfs           5.0M  8.0K  5.0M   1% /run/lock
tmpfs           392M  108K  392M   1% /run/user/1000
</code></pre><p>So now we&rsquo;ll use fdisk on our disk (the whole disk, not the partition)</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo fdisk /dev/vda

Welcome to fdisk (util-linux 2.39.3).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

GPT PMBR size mismatch (52428799 != 73400319) will be corrected by write.
The backup GPT table is not on the end of the device. This problem will be corrected by write.
This disk is currently in use - repartitioning is probably a bad idea.
It&#39;s recommended to umount all file systems, and swapoff all swap
partitions on this disk.
</code></pre><p>We can use &lsquo;p&rsquo; to print the partition table:</p>
<pre tabindex="0"><code>Command (m for help): p

Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB

Device     Start      End  Sectors Size Type
/dev/vda1   2048     4095     2048   1M BIOS boot
/dev/vda2   4096 52426751 52422656  25G Linux filesystem
</code></pre><p>Now, we&rsquo;ll delete the partition number 2 (the Linux filesystem one).
Note that this is &lsquo;safe&rsquo; because we are not actually deleting the partition, but rather the information about where the partition starts and where it ends.</p>
<pre tabindex="0"><code>Command (m for help): d
Partition number (1,2, default 2): 2

Partition 2 has been deleted.
</code></pre><p>And now, we&rsquo;ll recreate the partition, with the same start sector, but fdisk will extend the end to the last available sector on our disk, which is &lsquo;10G further&rsquo; than before.</p>
<pre tabindex="0"><code>Command (m for help): n
Partition number (2-128, default 2): 
First sector (4096-73400286, default 4096): 
Last sector, +/-sectors or +/-size{K,M,G,T,P} (4096-73400286, default 73398271): 

Created a new partition 2 of type &#39;Linux filesystem&#39; and of size 35 GiB.
Partition #2 contains a ext4 signature.

Do you want to remove the signature? [Y]es/[N]o: n
</code></pre><p>If we print the partition table again, we can see that our second partition is now 35G in size.</p>
<pre tabindex="0"><code>Command (m for help): p

Disk /dev/vda: 35 GiB, 37580963840 bytes, 73400320 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 42E119A3-9BE7-482B-AA89-803A5A7BFDAB

Device     Start      End  Sectors Size Type
/dev/vda1   2048     4095     2048   1M BIOS boot
/dev/vda2   4096 73398271 73394176  35G Linux filesystem
</code></pre><p>Finally, we do not forget to write our changes to the disk:</p>
<pre tabindex="0"><code>Command (m for help): w
The partition table has been altered.
Syncing disks.
</code></pre><p>Great. Now the disk has been resized, but the filesystem doesn&rsquo;t know it yet. If we rerun df, we&rsquo;ll see the same 25G listed:</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           392M  1.6M  391M   1% /run
/dev/vda2        25G  8.9G   15G  39% /
tmpfs           2.0G     0  2.0G   0% /dev/shm
tmpfs           5.0M  8.0K  5.0M   1% /run/lock
tmpfs           392M  108K  392M   1% /run/user/1000
</code></pre><p>To fix that, we&rsquo;ll use <code>resize2fs</code> that can extend a given ext4 partition. Here, we&rsquo;ll give it the partition path:</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo resize2fs /dev/vda2
resize2fs 1.47.0 (5-Feb-2023)
Filesystem at /dev/vda2 is mounted on /; on-line resizing required
old_desc_blocks = 4, new_desc_blocks = 5
The filesystem on /dev/vda2 is now 9174272 (4k) blocks long.
</code></pre><p>And if we check the output of df again, we now have 35G to play with !</p>
<pre tabindex="0"><code>coco@buntuvm:~$ sudo df -h
Filesystem      Size  Used Avail Use% Mounted on
tmpfs           392M  1.6M  391M   1% /run
/dev/vda2        35G  8.9G   24G  28% /
tmpfs           2.0G     0  2.0G   0% /dev/shm
tmpfs           5.0M  8.0K  5.0M   1% /run/lock
tmpfs           392M  108K  392M   1% /run/user/1000
</code></pre><p>Hopefully these instructions will serve me well next time (hey future me !)</p>
<p>Regards,
previous me</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/lvm/">Lvm</a></li>
      <li><a href="/tags/ext4/">Ext4</a></li>
      <li><a href="/tags/linux/">Linux</a></li>
      <li><a href="/tags/fdisk/">Fdisk</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="/posts/e-paper-frame/">
    <span class="title">« Prev</span>
    <br>
    <span>E Ink Message frame</span>
  </a>
  <a class="next" href="/posts/local-llm/">
    <span class="title">Next »</span>
    <br>
    <span>Using a local LLM as a personnal engineering sidekick</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="/">k0rventen&#39;s blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
